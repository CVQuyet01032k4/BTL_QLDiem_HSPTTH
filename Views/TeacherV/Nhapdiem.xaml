<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BTL_QLDiem_HSPTTH.TeacherVM"
             x:Class="BTL_QLDiem_HSPTTH.Views.TeacherV.Nhapdiem"
             x:Name="page"
             Title="Nhập điểm"
             BackgroundColor="#F2F6FF">

    <ContentPage.BindingContext>
        <vm:NhapdiemVM />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <Picker Title="Chọn phân công"
                    ItemsSource="{Binding DanhsachPhancong}"
                    SelectedItem="{Binding PhancongSelected}"
                    ItemDisplayBinding="{Binding Id}"
                    SelectedIndexChanged="Picker_PhancongChanged" />

            <Picker Title="Chọn học kỳ"
                    ItemsSource="{Binding DanhsachHocky}"
                    SelectedItem="{Binding HockySelected}"
                    ItemDisplayBinding="{Binding Tenhocky}" />

            <Button Text="Chọn lớp"
                    Command="{Binding LoadHocsinhCommand}" />

            <Picker Title="Chọn học sinh"
                    ItemsSource="{Binding DanhsachHocsinh}"
                    SelectedItem="{Binding HocsinhSelected}"
                    ItemDisplayBinding="{Binding Hoten}"
                    SelectedIndexChanged="Picker_HocsinhChanged" />

            <Picker x:Name="LoaiDiemPicker"
                    Title="Loại điểm"
                    SelectedIndexChanged="Picker_LoaiDiemChanged">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Miệng</x:String>
                        <x:String>15 phút</x:String>
                        <x:String>1 tiết</x:String>
                        <x:String>Thi</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <Entry Placeholder="Hệ số (1, 2, 3)"
                   Keyboard="Numeric"
                   Text="{Binding HeSo}" />

            <Entry Placeholder="Điểm số (0-10)"
                   Keyboard="Numeric"
                   Text="{Binding DiemSo}" />

            <Editor Placeholder="Ghi chú"
                    Text="{Binding GhiChu}"
                    HeightRequest="100" />

            <Button Text="Thêm điểm"
                    BackgroundColor="#0A66FF"
                    TextColor="White"
                    Command="{Binding AddDiemCommand}" />

            <Label Text="{Binding DiemTrungBinh, StringFormat='Điểm TB: {0:F2}'}"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="#0A66FF" />

            <CollectionView ItemsSource="{Binding DanhsachDiem}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Xóa"
                                               BackgroundColor="Red"
                                               Command="{Binding BindingContext.DeleteDiemCommand, Source={x:Reference page}}"
                                               CommandParameter="{Binding .}" />
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <Border Padding="15" Margin="0,5" BackgroundColor="White" StrokeShape="RoundRectangle 10">
                                <VerticalStackLayout>
                                    <Label Text="{Binding DiemSo, StringFormat='Điểm: {0:F1}'}" FontSize="16" FontAttributes="Bold"/>
                                    <Label Text="{Binding LoaiDiem, StringFormat='Loại: {0}'}" FontSize="14" TextColor="#666"/>
                                    <Label Text="{Binding HeSo, StringFormat='Hệ số: {0}'}" FontSize="14" TextColor="#666"/>
                                    <Label Text="{Binding GhiChu}" FontSize="12" TextColor="#888"/>
                                </VerticalStackLayout>
                            </Border>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
