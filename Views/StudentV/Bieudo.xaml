<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:BTL_QLDiem_HSPTTH.StudentVM"
             x:Class="BTL_QLDiem_HSPTTH.Views.StudentV.Bieudo"
             Title="Biểu đồ"
             BackgroundColor="#F2F6FF">

    <ContentPage.BindingContext>
        <vm:BieudoVM />
    </ContentPage.BindingContext>

    <VerticalStackLayout Padding="20" Spacing="15">

        <Picker Title="Chọn môn học (hoặc để trống để xem tất cả môn)"
                ItemsSource="{Binding DanhsachMon}"
                SelectedItem="{Binding MonSelected}"
                ItemDisplayBinding="{Binding Tenmh}"
                SelectedIndexChanged="Picker_Changed" />

        <Picker Title="Chọn học kỳ"
                ItemsSource="{Binding DanhsachHocky}"
                SelectedItem="{Binding HockySelected}"
                ItemDisplayBinding="{Binding Tenhocky}"
                SelectedIndexChanged="Picker_Changed" />

        <Button Text="Xem biểu đồ"
                BackgroundColor="#0A66FF"
                TextColor="White"
                Command="{Binding LoadDataCommand}" />

        <Border Padding="15" BackgroundColor="White" StrokeShape="RoundRectangle 10" Margin="0,20">
            <VerticalStackLayout>
                <Label Text="Biểu đồ điểm" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
                
                <!-- Simple bar chart representation -->
                <CollectionView ItemsSource="{Binding DiemDataPoints}" Margin="0,20">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <VerticalStackLayout Margin="0,10">
                                <Label Text="{Binding Label}" FontSize="14" FontAttributes="Bold"/>
                                <BoxView BackgroundColor="#0A66FF" 
                                         HeightRequest="{Binding Value, Converter={StaticResource DoubleToHeightConverter}}" 
                                         WidthRequest="50"
                                         HorizontalOptions="Start"/>
                                <Label Text="{Binding Value, StringFormat='{0:F2}'}" FontSize="12" TextColor="#666"/>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Border>

    </VerticalStackLayout>

</ContentPage>
